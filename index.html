<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–º–µ—Ç—ã</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å–±—Ä–æ—Å */
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        /* CSS –ü–ï–†–ï–ú–ï–ù–ù–´–ï
           –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ü–≤–µ—Ç–∞ Telegram, –Ω–æ –¥–ª—è –∫–Ω–æ–ø–æ–∫
           —Å–¥–µ–ª–∞–µ–º –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∏–∂–µ –≤ –º–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å–µ 
        */
        :root {
            --tg-bg: var(--tg-theme-bg-color, #ffffff);
            --tg-text: var(--tg-theme-text-color, #000000);
            --tg-hint: var(--tg-theme-hint-color, #999999);
            --tg-secondary-bg: var(--tg-theme-secondary-bg-color, #f0f0f0);
            
            /* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é (–¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã) –±–µ—Ä–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π —Ü–≤–µ—Ç –∫–Ω–æ–ø–∫–∏ */
            --main-btn-bg: var(--tg-theme-button-color, #2481cc);
            --main-btn-text: var(--tg-theme-button-text-color, #ffffff);
        }

        /* –•–ò–¢–†–û–°–¢–¨ –î–õ–Ø –°–í–ï–¢–õ–û–ô –¢–ï–ú–´:
           Telegram –Ω–µ –¥–∞–µ—Ç –ø—Ä—è–º–æ–≥–æ CSS-–∫–ª–∞—Å—Å–∞ "light-mode", –Ω–æ –º—ã –º–æ–∂–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –µ–≥–æ,
           –ø—Ä–æ–≤–µ—Ä–∏–≤, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ñ–æ–Ω —Å–≤–µ—Ç–ª—ã–º. –ï—Å–ª–∏ —Ñ–æ–Ω –ù–ï —á–µ—Ä–Ω—ã–π/—Ç–µ–º–Ω—ã–π -> –¥–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫–∏ —á–µ—Ä–Ω—ã–º–∏.
        */
        @media (prefers-color-scheme: light) {
            :root {
                --main-btn-bg: #000000 !important; /* –ß–µ—Ä–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –¥–Ω–µ–º */
                --main-btn-text: #ffffff !important;
            }
        }
        
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞: –µ—Å–ª–∏ —Ç–µ–ª–µ–≥—Ä–∞–º –ø–µ—Ä–µ–¥–∞–µ—Ç –±–µ–ª—ã–π —Ñ–æ–Ω, –∫—Ä–∞—Å–∏–º –∫–Ω–æ–ø–∫–∏ –≤ —á–µ—Ä–Ω—ã–π */
        body[style*="background-color: #ffffff"], 
        body[style*="background-color: rgb(255, 255, 255)"] {
            --main-btn-bg: #000000 !important;
            --main-btn-text: #ffffff !important;
        }

        body {
            background-color: var(--tg-bg);
            color: var(--tg-text);
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 0;
            user-select: none;
            transition: background-color 0.2s, color 0.2s;
        }

        .container {
            max-width: 420px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 120px;
        }

        h1 {
            font-size: 26px;
            font-weight: 800;
            margin-bottom: 5px;
            text-align: center;
            color: var(--tg-text);
            letter-spacing: -0.5px;
        }

        p.subtitle {
            color: var(--tg-hint);
            font-size: 13px; /* –ß—É—Ç—å —É–º–µ–Ω—å—à–∏–ª, —Ç–∞–∫ –∫–∞–∫ —Ç–µ–∫—Å—Ç–∞ —Å—Ç–∞–ª–æ –±–æ–ª—å—à–µ */
            text-align: center;
            margin-bottom: 25px;
            font-weight: 500;
            line-height: 1.4;
        }

        .section {
            margin-bottom: 20px;
            background: var(--tg-secondary-bg);
            padding: 15px;
            border-radius: 16px;
        }

        .label {
            display: block;
            font-size: 12px;
            font-weight: 700;
            color: var(--tg-hint);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ */
        input[type="number"] {
            width: 100%;
            background: var(--tg-bg);
            border: 2px solid transparent;
            color: var(--tg-text);
            padding: 14px;
            border-radius: 12px;
            font-size: 18px;
            outline: none;
            transition: all 0.2s;
            font-family: monospace;
            font-weight: 600;
        }

        input[type="number"]::placeholder {
            color: var(--tg-hint);
            opacity: 0.5;
        }

        input[type="number"]:focus {
            border-color: var(--main-btn-bg); /* –†–∞–º–∫–∞ —Ü–≤–µ—Ç–∞ –∫–Ω–æ–ø–∫–∏ */
        }

        .select-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .select-grid.full-width {
            grid-template-columns: 1fr;
        }

        /* –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ (Radio buttons) */
        .radio-btn {
            background: var(--tg-bg);
            border: 1px solid transparent;
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--tg-text);
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .radio-btn.active {
            background: var(--main-btn-bg); /* –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—à –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ü–≤–µ—Ç */
            color: var(--main-btn-text);
            font-weight: 700;
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ */
        .btn-calc {
            background: var(--main-btn-bg); /* –ß–µ—Ä–Ω—ã–π –¥–Ω–µ–º, —Å–∏—Å—Ç–µ–º–Ω—ã–π –Ω–æ—á—å—é */
            color: var(--main-btn-text);
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 16px;
            font-size: 18px;
            font-weight: 800;
            margin-top: 15px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: transform 0.1s, opacity 0.2s;
        }
        .btn-calc:active { 
            transform: scale(0.97); 
            opacity: 0.9;
        }

        /* –®—Ç–æ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ */
        .result-overlay {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 85vh;
            background: var(--tg-bg);
            border-top: 1px solid var(--tg-secondary-bg);
            padding: 30px 20px;
            border-radius: 24px 24px 0 0;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.2);
            transform: translateY(110%);
            transition: transform 0.3s cubic-bezier(0.19, 1, 0.22, 1);
            z-index: 100;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .result-overlay.show {
            transform: translateY(0);
        }

        .result-header {
            font-size: 13px;
            text-align: center;
            color: var(--tg-hint);
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .final-price {
            font-size: 42px;
            font-weight: 800;
            color: var(--tg-text);
            text-align: center;
            margin-bottom: 20px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 15px;
            padding: 12px 0;
            border-bottom: 1px solid var(--tg-secondary-bg);
            color: var(--tg-text);
        }

        .close-res {
            position: absolute;
            top: 15px;
            right: 20px;
            color: var(--tg-hint);
            font-size: 30px;
            line-height: 20px;
            cursor: pointer;
            padding: 10px;
        }

        .msg-box {
            background: var(--tg-secondary-bg);
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            color: var(--tg-text);
            font-size: 15px;
            line-height: 1.5;
            white-space: pre-wrap;
            border: 1px solid transparent;
        }

        .msg-label {
            font-size: 11px;
            color: var(--tg-hint);
            margin-bottom: 5px;
            text-transform: uppercase;
            margin-top: 25px;
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-act {
            flex: 1;
            padding: 14px;
            border-radius: 12px;
            border: 1px solid var(--tg-hint);
            background: transparent;
            color: var(--tg-text);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-act:active {
            background: var(--tg-secondary-bg);
            transform: scale(0.98);
        }

        /* –ö–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å" —Ç–æ–∂–µ –Ω–∞—Å–ª–µ–¥—É–µ—Ç —á–µ—Ä–Ω—ã–π —Ü–≤–µ—Ç */
        .btn-primary-act {
            background: var(--main-btn-bg);
            color: var(--main-btn-text);
            border-color: var(--main-btn-bg);
        }

    </style>
</head>
<body>

<div class="container">
    <h1>–ö–∞–∫—É—é —Ü–µ–Ω—É –Ω–∞–∑–≤–∞—Ç—å?</h1>
    <p class="subtitle">–£–º–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–ª—è —Ñ—Ä–∏–ª–∞–Ω—Å–µ—Ä–∞<br>–æ—Ç –ê–∑–∏–∑–∞ –ê–º–µ—Ç–æ–≤–∞</p>

    <div class="section">
        <label class="label">–¢–≤–æ–π –æ–±—ã—á–Ω—ã–π —Ä–µ–π—Ç (–ë–∞–∑–∞):</label>
        <input type="number" id="base-price" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 15000" inputmode="numeric">
    </div>

    <div class="section">
        <label class="label">–£—Ä–æ–≤–µ–Ω—å –±–æ–ª–∏ (–°–ª–æ–∂–Ω–æ—Å—Ç—å):</label>
        <div class="select-grid full-width" id="complex-group">
            <div class="radio-btn" data-val="0.7">üòå –ò–∑–∏ –º–∞–Ω–∏</div>
            <div class="radio-btn" data-val="1.1">ü§î –õ–µ–≥–∫–æ, –Ω–æ –¥–æ–ª–≥–æ</div>
            <div class="radio-btn active" data-val="1.0">‚ö°Ô∏è –°—Ç–∞–Ω–¥–∞—Ä—Ç</div>
            <div class="radio-btn" data-val="1.4">üò∞ –ü–æ—Ç–Ω–∞—è –∫–∞—Ç–∫–∞</div>
            <div class="radio-btn" data-val="2.5">ü§Ø –ü–æ–ª–Ω—ã–π –≥–µ–º–æ—Ä—Ä–æ–π</div>
        </div>
    </div>

    <div class="section">
        <label class="label">–î–µ–¥–ª–∞–π–Ω:</label>
        <div class="select-grid" id="deadline-group">
            <div class="radio-btn active" data-val="1">üëå –ö–æ–º—Ñ–æ—Ä—Ç–Ω–æ</div>
            <div class="radio-btn" data-val="1.2">üî• –°—Ä–æ—á–Ω–æ</div>
            <div class="radio-btn" data-val="1.5">‚ò†Ô∏è –í—á–µ—Ä–∞</div>
            <div class="radio-btn" data-val="2.0">üåô –ù–æ—á—å—é</div>
        </div>
    </div>

    <div class="section">
        <label class="label">–ö—Ç–æ –∫–ª–∏–µ–Ω—Ç:</label>
        <div class="select-grid" id="client-group">
            <div class="radio-btn active" data-val="1">üë§ –ù–æ–≤—ã–π</div>
            <div class="radio-btn" data-val="1.3">üè¢ –ö–æ–º–ø–∞–Ω–∏—è</div>
            <div class="radio-btn" data-val="0.8">ü§ù –ë—Ä–∞—Ç–∞–Ω</div>
            <div class="radio-btn" data-val="2.0">üßü –¢–æ–∫—Å–∏–∫</div>
        </div>
    </div>

    <button class="btn-calc" id="btn-calc">–†–ê–°–°–ß–ò–¢–ê–¢–¨ –°–¢–û–ò–ú–û–°–¢–¨</button>
</div>

<div class="result-overlay" id="result-panel">
    <div class="close-res" id="close-btn">√ó</div>
    
    <div class="result-header">–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</div>
    <div class="final-price" id="final-price">0 ‚ÇΩ</div>

    <div class="info-row">
        <span style="opacity: 0.7">–ú–∏–Ω–∏–º–∞–ª–∫–∞ (–¢–æ—Ä–≥):</span>
        <span id="min-price" style="font-weight: 600">0 ‚ÇΩ</span>
    </div>
    <div class="info-row">
        <span style="opacity: 0.7">–ú–∞–∫—Å–∏–º—É–º (–ù–∞–≥–ª–æ—Å—Ç—å):</span>
        <span id="max-price" style="font-weight: 600">0 ‚ÇΩ</span>
    </div>

    <div>
        <div class="msg-label">–®–∞–±–ª–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞:</div>
        <div class="msg-box" id="client-msg">...</div>
        
        <div class="actions">
            <button class="btn-act" id="btn-copy">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn-act btn-primary-act" id="btn-share">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
    </div>

    <div style="height: 50px;"></div>
</div>

<script>
    let tg = window.Telegram ? window.Telegram.WebApp : null;
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∂–µ—Å—Ç–∫–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã —á–µ—Ä–µ–∑ JS, –µ—Å–ª–∏ CSS –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª
    function applyThemeColors() {
        if (!tg) return;
        
        // –ü–æ–ª—É—á–∞–µ–º —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç–µ–º—ã Telegram
        const bgColor = tg.themeParams.bg_color || '#ffffff';
        
        // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ —Ñ–æ–Ω —Å–≤–µ—Ç–ª—ã–π (–±–µ–ª—ã–π –∏–ª–∏ –æ–∫–æ–ª–æ —Ç–æ–≥–æ)
        // #ffffff, #f0f0f0 –∏ —Ç.–¥. —Å—á–∏—Ç–∞–µ–º —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–æ–π
        const isLight = bgColor.toLowerCase() === '#ffffff' || bgColor.toLowerCase() === '#f2f2f7';
        
        const root = document.documentElement;
        if (isLight) {
            root.style.setProperty('--main-btn-bg', '#000000');
            root.style.setProperty('--main-btn-text', '#ffffff');
        } else {
            // –ï—Å–ª–∏ —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π —Ü–≤–µ—Ç
            root.style.setProperty('--main-btn-bg', 'var(--tg-theme-button-color, #2481cc)');
            root.style.setProperty('--main-btn-text', 'var(--tg-theme-button-text-color, #ffffff)');
        }
    }

    if(tg) {
        tg.expand();
        tg.setHeaderColor(getComputedStyle(document.body).getPropertyValue('--tg-bg'));
        tg.MainButton.hide();
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–µ–º—ã
        applyThemeColors();
        tg.onEvent('themeChanged', applyThemeColors);
    }

    function setupRadioGroup(groupId) {
        const container = document.getElementById(groupId);
        const buttons = container.querySelectorAll('.radio-btn');
        buttons.forEach(btn => {
            btn.addEventListener('click', () => {
                buttons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                if(tg) tg.HapticFeedback.selectionChanged();
            });
        });
    }

    setupRadioGroup('deadline-group');
    setupRadioGroup('client-group');
    setupRadioGroup('complex-group');

    function getGroupValue(groupId) {
        const container = document.getElementById(groupId);
        const active = container.querySelector('.active');
        return parseFloat(active.getAttribute('data-val'));
    }

    function formatMoney(amount) {
        return amount.toLocaleString('ru-RU') + ' ‚ÇΩ';
    }

    function generateClientMessage(price, clientType, deadline) {
        const p = formatMoney(price);
        let templates = [];

        if (clientType < 1) {
            templates = [
                `–ü—Ä–∏–≤–µ—Ç! üëã –ü—Ä–∏–∫–∏–Ω—É–ª –ø–æ –∑–∞–¥–∞—á–µ.\n–ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –≤—Å–µ —á–µ—Ç–∫–æ, –ø–æ –±—é–¥–∂–µ—Ç—É –≤—ã–π–¥–µ—Ç ${p}.\n–ì–æ—Ç–æ–≤ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å.`,
                `–°–∞–ª—é—Ç! –ü–æ—Å—á–∏—Ç–∞–ª —Å–º–µ—Ç—É.\n–ò—Ç–æ–≥–æ: ${p}.\n–°–¥–µ–ª–∞—é –ø–æ –∫—Ä–∞—Å–æ—Ç–µ, –∫–∞–∫ –æ–±—ã—á–Ω–æ.`,
                `–ü—Ä–∏–≤–µ—Ç. –ì–ª—è–Ω—É–ª –¢–ó.\n–ü–æ –¥–µ–Ω—å–≥–∞–º ${p}, –ø–æ —Å—Ä–æ–∫–∞–º —É—Å–ø–µ–µ–º.`,
                `–ü—Ä–∏–≤–µ—Ç! –ó–∞ ${p} –≥–æ—Ç–æ–≤ –∑–∞–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –∏ —Å–¥–µ–ª–∞—Ç—å –≤ –ª—É—á—à–µ–º –≤–∏–¥–µ.`
            ];
        } 
        else if (deadline >= 1.2) {
            templates = [
                `–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –£—á–∏—Ç—ã–≤–∞—è —Å–∂–∞—Ç—ã–µ —Å—Ä–æ–∫–∏, —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ—Å—Ç–∞–≤–∏—Ç ${p}.\n–°–º–æ–≥—É –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.`,
                `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ. –ß—Ç–æ–±—ã —É—Å–ø–µ—Ç—å –∫ –¥–µ–¥–ª–∞–π–Ω—É, –ø—Ä–∏–¥–µ—Ç—Å—è –ø–æ–¥–≤–∏–Ω—É—Ç—å –¥—Ä—É–≥–∏–µ –∑–∞–¥–∞—á–∏.\n–û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞: ${p}.`,
                `–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é! –ü–æ —Å—Ä–æ—á–Ω–æ–º—É —Ç–∞—Ä–∏—Ñ—É –≤—ã—Ö–æ–¥–∏—Ç ${p}.\n–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É—é, —á—Ç–æ —É—Å–ø–µ–µ–º –≤–æ–≤—Ä–µ–º—è.`
            ];
        } 
        else {
            templates = [
                `–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –û–∑–Ω–∞–∫–æ–º–∏–ª—Å—è —Å –∑–∞–¥–∞—á–µ–π.\n–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–¥ –∫–ª—é—á: ${p}.\n–í —ç—Ç—É —Å—É–º–º—É –≤–∫–ª—é—á–µ–Ω—ã –ø—Ä–∞–≤–∫–∏ –∏ –∏—Å—Ö–æ–¥–Ω–∏–∫–∏.`,
                `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ.\n–ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞: ${p}.\n–ì–æ—Ç–æ–≤ –æ–±—Å—É–¥–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∏ –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å –∫ —Ä–∞–±–æ—Ç–µ.`,
                `–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é! –û—Ü–µ–Ω–∫–∞ –ø–æ –≤–∞—à–µ–º—É –¢–ó: ${p}.\n–ö–∞—á–µ—Å—Ç–≤–æ –∏ —Å—Ä–æ–∫–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é.`,
                `–î–æ–±—Ä—ã–π –¥–µ–Ω—å. –ò—Ç–æ–≥–æ–≤–∞—è —Å–º–µ—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî ${p}.\n–ñ–¥—É –≤–∞—à–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è!`
            ];
        }
        return templates[Math.floor(Math.random() * templates.length)];
    }

    let currentMsg = "";

    document.getElementById('btn-calc').addEventListener('click', () => {
        const basePrice = parseFloat(document.getElementById('base-price').value);
        
        if (!basePrice) {
            if(tg) tg.HapticFeedback.notificationOccurred('error');
            const input = document.getElementById('base-price');
            input.style.borderColor = '#e74c3c';
            setTimeout(() => input.style.borderColor = 'transparent', 500);
            return;
        }

        if(tg) tg.HapticFeedback.impactOccurred('medium');

        const mDeadline = getGroupValue('deadline-group');
        const mClient = getGroupValue('client-group');
        const mComplex = getGroupValue('complex-group');

        let total = basePrice * mDeadline * mClient * mComplex;
        total = Math.ceil(total / 100) * 100;

        const minTotal = Math.floor((total * 0.85) / 100) * 100;
        const maxTotal = Math.ceil((total * 1.25) / 100) * 100;

        document.getElementById('final-price').innerText = formatMoney(total);
        document.getElementById('min-price').innerText = formatMoney(minTotal);
        document.getElementById('max-price').innerText = formatMoney(maxTotal);

        currentMsg = generateClientMessage(total, mClient, mDeadline);
        document.getElementById('client-msg').innerText = currentMsg;

        document.getElementById('result-panel').classList.add('show');
    });

    document.getElementById('close-btn').addEventListener('click', () => {
        document.getElementById('result-panel').classList.remove('show');
    });

    document.getElementById('btn-copy').addEventListener('click', () => {
        navigator.clipboard.writeText(currentMsg).then(() => {
            const btn = document.getElementById('btn-copy');
            const oldText = btn.innerText;
            btn.innerText = "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!";
            btn.style.backgroundColor = "var(--tg-secondary-bg)";
            
            if(tg) tg.HapticFeedback.notificationOccurred('success');
            
            setTimeout(() => {
                btn.innerText = oldText;
                btn.style.backgroundColor = "transparent";
            }, 1500);
        });
    });

    document.getElementById('btn-share').addEventListener('click', () => {
        if(tg) {
            const url = "https://t.me/share/url?url=" + encodeURIComponent(currentMsg);
            tg.openTelegramLink(url);
        } else {
            alert("–†–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ Telegram");
        }
    });

</script>

</body>
</html>